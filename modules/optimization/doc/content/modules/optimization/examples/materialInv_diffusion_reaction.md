# Material Inversion Example: Nonlinear Diffusion Reaction

The following illustrates the capability of the MOOSE-Opt by applying the module to a nonlinear, material-inversion optimization problem:

!equation
\begin{split}
&\min_p f(u, \sigma) = \frac{1}{2}\sum^N_{i=1} \left(u_i - \tilde{u}_i\right)^2; \\
&\text{subject to}
\left\{\begin{array}{lr}
\dot{u} - \vec{\nabla}\cdot(1+u)\vec{\nabla}u + \sigma u = 1 & \text{in} \, t=[0,1],\Omega=(0,1)^2\\
u(t=0) = 0 & \\
u(x=0) = u(y=0) = 0 & \\
\left.\frac{\partial u}{\partial x}\right|_{x=1} = \left.\frac{\partial u}{\partial y}\right|_{y=1} = 0 \\
\sigma \geq 0
\end{array}\right.,
\end{split}

where $N$ is the number of measurement locations and $u_i$ and $\tilde{u}_i$ are the simulated and measured state variables (e.g. temperature and displacement fields), respectively, at location $i$. The parameter being optimized is the spatially dependent reaction rate ($\sigma$). The domain is meshed using a $16\times16$ grid of quadrilateral elements, and time is discretized using implict Euler over ten uniform time steps. The measurement data is generated by evaluating the PDE with $\sigma = e^{xy} - 1$ and sampling the resulting solution at 17 locations---shown in top left plot of \cref{fig:diff_react}---at every time step, resulting in $N=170$.

The reaction rate is parameterized using the mesh shown in the top right plot of [!ref](fig:forward_exact), where parameter values set the reaction rate at the 19 nodes and linearly interpolating between them. The initial condition for the optimization sets $\sigma=0$, emulating a diffusion-only system. TAO's bounded quasi-Newton line search (`TAOBQNLS`) was the chosen optimization algorithm. The following listings show the optimization input driving the optimization solve and the physics sub-application input used to calculate the forward and adjoint simulations.

!listing diffusion_reaction/optimize.i
  caption=Optimization input
  id=lst:optimize

!listing diffusion_reaction/forward_and_adjoint.i
  caption=Physics sub-application
  id=lst:forward

[!ref](fig:optimize_out_forward0) shows the rate found from the optimization process. [!ref](fig:solution_compare) shows how close the the solution from the optimized reaction is from the synthetic measurement data produced.

!media diffusion_reaction/forward_exact.png
  caption=Exact reaction rate, simulation mesh, and measurement locations.
  id=fig:forward_exact

!media diffusion_reaction/optimize_out_forward0.png
  caption=Optimized rection rate and parameter mesh.
  id=fig:optimize_out_forward0

!media diffusion_reaction/solution_compare.png
  caption=Comparing simulated transient solution with exact, initial optimization guess, and optimized reaction rate at several measurement locations (measurement and optimized data are visually identical).
  id=fig:solution_compare
